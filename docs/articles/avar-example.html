<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Allan Variance Linear Regression Estimation Examples • avar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Allan Variance Linear Regression Estimation Examples">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">avar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/avar-example.html">Examples</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/SMAC-Group/av">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Allan Variance Linear Regression Estimation Examples</h1>
            
            <h4 class="date">2020-01-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/SMAC-Group/avar/blob/master/vignettes/avar-example.Rmd"><code>vignettes/avar-example.Rmd</code></a></small>
      <div class="hidden name"><code>avar-example.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(avar)</span></code></pre></div>
<div id="simulated-data" class="section level2">
<h2 class="hasAnchor">
<a href="#simulated-data" class="anchor"></a>Simulated Data</h2>
<p>To understand the features of the <code>avar</code> package, we first illustrate with a simulated data of sample size <span class="math inline">\(n = 10^5\)</span> coming from a White Noise (WN) plus Random Walk (RW) model. The corresponding (maximum-overlap) Allan Variance representation is given in the following figure:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">2710</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co"># Simulate data</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>n =<span class="st"> </span><span class="fl">1e5</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>data =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(n, <span class="dv">0</span>, <span class="fl">0.01</span>) <span class="op">+</span><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cumsum">cumsum</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(n, <span class="dv">0</span>, <span class="fl">3.162278e-05</span>))</span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co"># Compute the Maximum-Overlap Allan Variance</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>allan_variance =<span class="st"> </span><span class="kw"><a href="../reference/avar.html">avar</a></span>(data, <span class="dt">type =</span> <span class="st">"mo"</span>)</span>
<span id="cb2-9"><a href="#cb2-9"></a></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co"># Log-Log representation of the Allan Variance</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(allan_variance)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="avar-example_files/figure-html/unnamed-chunk-2-1.png" alt="Allan Variance Representation." width="672"><p class="caption">
Allan Variance Representation.
</p>
</div>
<p>Based on this graph, it is possible to detect the models underlying the simulated data. Indeed, we can see that our model should include a WN process when considering the first 7 scales and a RW process when considering the last 3 scales. Therefore, using these scales we can make use of the traditional “Allan Variance slope method” to estimate the parameters of these two processes.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Specify the scale at which we want to fit the WN and RW processes</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>wn =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">7</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>rw =<span class="st"> </span><span class="dv">13</span><span class="op">:</span><span class="dv">15</span></span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co"># Compute the Allan Variance Linear Regression Estimator (AVLR)</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>fit =<span class="st"> </span><span class="kw"><a href="../reference/avlr.html">avlr</a></span>(allan_variance, <span class="dt">wn =</span> wn, <span class="dt">rw =</span> rw)</span>
<span id="cb3-7"><a href="#cb3-7"></a>fit</span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt; </span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt;  Estimates: </span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">#&gt;           Value</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">#&gt; WN 1.007431e-02</span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">#&gt; RW 1.358511e-05</span></span></code></pre></div>
<p>Now that we have computed the parameters of interest, we can visually check if the chosen latent model fits the data at hand well. To do so we can simply use the <code>plot</code> function and, if we would like to observe how the individual processes contribute to the overall fit, we can set the parameter <code>decomp = TRUE</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(fit)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="avar-example_files/figure-html/unnamed-chunk-4-1.png" alt="Empirical AV with AV implied by the latent model" width="672"><p class="caption">
Empirical AV with AV implied by the latent model
</p>
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(fit, <span class="dt">decomp =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="avar-example_files/figure-html/unnamed-chunk-4-2.png" alt="Empirical AV with AV implied by the latent model" width="672"><p class="caption">
Empirical AV with AV implied by the latent model
</p>
</div>
<p>As we can see, the model fits the data well. Therefore, we are going to compute the confidence intervals for these parameters by specifiying the option <code>ci = TRUE</code>. These confidence intervals are computed via parametric bootstrap for which the number of replications can be defined through the parameter <code>B</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># AVLR estimator with 95% confidence intervals</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>fit_ci =<span class="st"> </span><span class="kw"><a href="../reference/avlr.html">avlr</a></span>(allan_variance, <span class="dt">wn =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="dt">rw =</span> <span class="dv">13</span><span class="op">:</span><span class="dv">15</span>, <span class="dt">ci =</span> <span class="ot">TRUE</span>, <span class="dt">B =</span> <span class="dv">100</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a>fit_ci<span class="op">$</span>ci</span></code></pre></div>
<pre><code>#&gt; $mu
#&gt; [1] 0.0100782190 0.0000121613
#&gt; 
#&gt; $ci
#&gt;              [,1]         [,2]
#&gt; [1,] 1.005670e-02 1.008411e-02
#&gt; [2,] 1.392184e-05 1.609601e-05
#&gt; 
#&gt; $sd
#&gt; [1] 5.526008e-05 4.383085e-06</code></pre>
</div>
<div id="real-imu-data" class="section level2">
<h2 class="hasAnchor">
<a href="#real-imu-data" class="anchor"></a>Real IMU Data</h2>
<p>We can further illustrate the features of the <code>avar</code> package using the Allan variance computed based on real IMU data. Specifically, we consider the Allan variance of IMU data collected from a navchip sensor, i.e. <code>navchip_av</code>, whose sample size is about <span class="math inline">\(n = 3 \cdot 10^6\)</span>. The Allan variance representation corresponding to this dataset is given in the following figure:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"navchip_av"</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(navchip_av)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="avar-example_files/figure-html/unnamed-chunk-7-1.png" alt="Allan Variance Representation." width="768"><p class="caption">
Allan Variance Representation.
</p>
</div>
<p>Based on the graph, we can see that for the gyroscope components, the underlying model should include a Quantization Noise (QN) for the first 4 scales, a WN for the 6th to 8th scales, and a RW for the 10th to 13th scales. Similarly for the accelerometer components, the underlying model should include a WN for the first 6 scales and a RW for the 14th to 16th scales. Therefore, we can estimate the underlying model with the following:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>fit2 =<span class="st"> </span><span class="kw"><a href="../reference/avlr.html">avlr</a></span>(navchip_av, <span class="dt">qn_gyro =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">wn_gyro =</span> <span class="dv">6</span><span class="op">:</span><span class="dv">8</span>, <span class="dt">rw_gyro =</span> <span class="dv">10</span><span class="op">:</span><span class="dv">13</span>,</span>
<span id="cb9-2"><a href="#cb9-2"></a>           <span class="dt">wn_acc =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">rw_acc =</span> <span class="dv">14</span><span class="op">:</span><span class="dv">16</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a>fit2</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">#&gt; </span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">#&gt;  Estimates for gyroscopes: </span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">#&gt;           Value</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">#&gt; WN 5.945877e-05</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">#&gt; QN 7.208553e-06</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co">#&gt; RW 3.062325e-05</span></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="co">#&gt; </span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co">#&gt;  Estimates for accelerometers: </span></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="co">#&gt;           Value</span></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co">#&gt; WN 5.233402e-04</span></span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="co">#&gt; RW 6.422082e-05</span></span></code></pre></div>
<p>And we can visualize to check if the estimated underlying model fits the data well simply with the <code>plot</code> function.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(fit2)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="avar-example_files/figure-html/unnamed-chunk-9-1.png" alt="Empirical AV with AV implied by the latent model" width="768"><p class="caption">
Empirical AV with AV implied by the latent model
</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#simulated-data">Simulated Data</a></li>
      <li><a href="#real-imu-data">Real IMU Data</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Stéphane Guerrier, James Balamuta, Gaetan Bakalli, Roberto Molinari, Justin Lee, Ahmed Radi, Haotian Xu, Yuming Zhang, Nathanael Claussen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
